<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="mybatis.mapper.music">
	<!-- 1. 재생 횟수 랜덤 -->
	<update id="randomcount">
		UPDATE song SET playcount = ROUND(DBMS_RANDOM.VALUE(0, 10000))
	</update>
	<!-- 2. hot 10 -->
	<select id="chart10" resultType="vo.SongVO">
		<![CDATA[
			SELECT * FROM 
				(SELECT * FROM song
				ORDER BY playcount desc)
			WHERE ROWNUM <= 10
		]]>
	</select>
	<!-- 3. hot 100 -->
	<select id="chart100" resultType="vo.SongVO">
		<![CDATA[
			SELECT * FROM 
				(SELECT * FROM song
				ORDER BY playcount desc)
			WHERE ROWNUM <= 100
		]]>
	</select>
	<!-- 4. 노래 정보(1) -->
	<select id="songinfo_1" parameterType="int" resultType="vo.SongVO">
		SELECT * FROM song WHERE song_number=#{song_number}
	</select>
	<!-- 5. 노래 정보(2) -->
	<select id="songinfo_2" parameterType="int" resultType="vo.AlbumVO">
		SELECT * FROM album WHERE album_name=(
		    SELECT album_name
		    FROM song
		    WHERE song_number=#{song_number})
	</select>
	<!-- 6. 가수 정보 -->
	<select id="singerinfo" parameterType="String" resultType="vo.SingerVO">
		SELECT * FROM singer WHERE singer=#{singer}
	</select>
	<!-- 7. 앨범 정보 -->
	<select id="albuminfo" parameterType="vo.AlbumVO" resultType="vo.AlbumVO">
		SELECT * FROM album WHERE singer=#{singer} AND album_name=#{album_name}
	</select>
	<!-- 8. 검색(가수) -->
	<select id="searchsinger" parameterType="String" resultType="vo.SongVO">
		SELECT * FROM song WHERE singer LIKE '%' || #{q} || '%'
	</select>
	<!-- 9. 검색(노래) -->
	<select id="searchsong" parameterType="String" resultType="vo.SongVO">
		SELECT * FROM song WHERE song_name LIKE '%' || #{q} || '%'
	</select>
	<!-- 10. 검색(앨범) -->
	<select id="searchalbum" parameterType="String" resultType="vo.SongVO">
		SELECT * FROM song WHERE album_name LIKE '%' || #{q} || '%'
	</select>
	<!-- 11. 플레이리스트 수정 -->
	<update id="updateFavorite" parameterType="vo.JmuserVO">
		UPDATE jmuser SET jmuser_favorite=#{jmuser_favorite} WHERE jmuser_idx=#{jmuser_idx}
	</update>
</mapper>